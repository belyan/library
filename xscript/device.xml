<?xml version="1.0" encoding="utf-8"?>
<device>
    <mobile-block>
        <method>detect_phone</method>
        <xpath expr="boolean(/model)" result="is_mobile"/>
    </mobile-block>

    <!-- Предпочитаемая версия сайта (0 - мобильная, 1 - полная) -->
    <custom-morda>
        <guard type="StateArg">is_mobile</guard>
        <method>set_state_by_tune</method>
        <param type="String">site_version</param>
        <param type="Long">44</param>
    </custom-morda>

    <!-- Редиректим на мобильную версию -->
    <lua guard="is_mobile">
        <![CDATA[
            local mobile_url = 'http://m.' .. xscript.request:getHost()
            if xscript.state:get('site_version') ~= '1' then
                xscript.suppressBody()
                xscript.response:redirectToPath(mobile_url)
            end
        ]]>
    </lua>
</device>
